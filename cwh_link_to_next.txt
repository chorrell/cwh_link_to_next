# cwh_link_to_next v0.1
# A replacement tag for <txp:link_to_next /> that includes the ability to set the output format as a <link> tag.
# Christopher Horrell
# http://horrell.ca/

# ......................................................................
# This is a plugin for Textpattern - http://textpattern.com/
# To install: textpattern > admin > plugins
# Paste the following text into the 'Install plugin' box:
# ......................................................................

YTo5OntzOjQ6Im5hbWUiO3M6MTY6ImN3aF9saW5rX3RvX25leHQiO3M6NzoidmVyc2lvbiI7
czozOiIwLjEiO3M6NjoiYXV0aG9yIjtzOjE5OiJDaHJpc3RvcGhlciBIb3JyZWxsIjtzOjEw
OiJhdXRob3JfdXJpIjtzOjE4OiJodHRwOi8vaG9ycmVsbC5jYS8iO3M6MTE6ImRlc2NyaXB0
aW9uIjtzOjExMDoiQSByZXBsYWNlbWVudCB0YWcgZm9yIDx0eHA6bGlua190b19uZXh0IC8+
IHRoYXQgaW5jbHVkZXMgdGhlIGFiaWxpdHkgdG8gc2V0IHRoZSBvdXRwdXQgZm9ybWF0IGFz
IGEgPGxpbms+IHRhZy4iO3M6NDoidHlwZSI7aTowO3M6NDoiaGVscCI7czoyMDU3OiIJPHA+
VGhpcyBpcyBhIHJlcGxhY2VtZW50IHRhZyBmb3IgPGNvZGU+JiM2MDt0eHA6bGlua190b19u
ZXh0IC8mIzYyOzwvY29kZT4gdGhhdCBpbmNsdWRlcyBhIG5ldyA8ZW0+Zm9ybWF0PC9lbT4g
YXR0cmlidXRlIHdoaWNoIHByb3ZpZGVzIHRoZSBhYmlsaXR5IHRvIHNldCB0aGUgbGluayBm
b3JtYXQgYXMgYSA8Y29kZT4mIzYwO2xpbmsmIzYyOzwvY29kZT4gdGFnIHN1aXRhYmxlIGZv
ciBwbGFjaW5nIGluIHRoZSA8Y29kZT4mIzYwO2hlYWQmIzYyOzwvY29kZT4gb2YgYW55IGlu
ZGl2aWR1YWwgYXJ0aWNsZSBwYWdlIG9uIHlvdXIgc2l0ZS4gWW91IGNhbiBkbyB0aGlzIGJ5
IHNldHRpbmcgdGhlIDxlbT5mb3JtYXQ8L2VtPiBhdHRyaWJ1dGUgbGlrZSBzbzo8L3A+CgoJ
PHA+PGNvZGU+JiM2MDt0eHA6Y3doX2xpbmtfdG9faG9tZSB0aXRsZT0mIzM0O0hvbWUmIzM0
OyBmb3JtYXQ9JiMzNDtsaW5rJiMzNDsgLyYjNjI7PC9jb2RlPjwvcD4KCgk8cD53aGljaCB3
aWxsIHByb2R1Y2Ugc29tZXRoaW5nIHNpbWlsYXIgdG86PC9wPgoKCTxwPjxjb2RlPiYjNjA7
bGluayByZWw9JiMzNDtuZXh0JiMzNDsgaHJlZj0mIzM0O2h0dHA6Ly9leGFtcGxlLmNvbS9h
cnRpY2xlLzIvbmV4dC1wb3N0JiMzNDsgdGl0bGU9JiMzNDtOZXh0IFBvc3QmIzM0OyAvJiM2
Mjs8L2NvZGU+PC9wPgoKCTxwPk5vdGUgdGhhdCB3aGVuIHVzZWQgYXMgYSBzaW5nbGUgdGFn
IHdpdGhvdXQgdGhlIDxlbT5mb3JtYXQ8L2VtPiBhdHRyaWJ1dGUgc3BlY2lmaWVkOjwvcD4K
Cgk8cD48Y29kZT4mIzYwO3R4cDpjd2hfbGlua190b19uZXh0IC8mIzYyOzwvY29kZT48L3A+
CgoJPHA+aXQgd2lsbCBwcm9kdWNlIGEgcGxhaW4gdGV4dCBsaW5rIG11Y2ggaW4gdGhlIHNh
bWUgd2F5IGFzIDxjb2RlPiYjNjA7dHhwOmxpbmtfdG9fbmV4dCAvJiM2Mjs8L2NvZGU+Ojwv
cD4KCgk8cD48Y29kZT5odHRwOi8vZXhhbXBsZS5jb20vYXJ0aWNsZS8yL25leHQtcG9zdDwv
Y29kZT48L3A+CgoJPHA+RmluYWxseSwgaXQgY2FuIGFsc28gYmUgdXNlZCBhcyBhIGNvbnRh
aW5lciB0YWcgaW4gdGhlIHNhbWUgbWFubmVyIGFzIDxjb2RlPiYjNjA7dHhwOmxpbmtfdG9f
bmV4dCAvJiM2Mjs8L2NvZGU+IGlmIG5vIDxlbT5mb3JtYXQ8L2VtPiB2YWx1ZSBpcyBzcGVj
aWZpZWQ6PC9wPgoKCTxwPjxjb2RlPiYjNjA7dHhwOmN3aF9saW5rX3RvX25leHQmIzYyOyAu
Li5UZXh0IG9yIFRhZy4uLiAmIzYwOy90eHA6Y3doX2xpbmtfdG9fbmV4dCYjNjI7PC9jb2Rl
PjwvcD4KCgk8cD5JZiB5b3UgZG8gc3BlY2lmeSBhIDxlbT5saW5rPC9lbT4gdmFsdWUgZm9y
IHRoZSA8ZW0+Zm9ybWF0PC9lbT4gYXR0cmlidXRlIHdoaWxlIHVzZWQgYXMgYSBjb250YWlu
ZXIgdGFnLCBpdCB3aWxsIHN0aWxsIHByb2R1Y2UgYSA8Y29kZT4mIzYwO2xpbmsmIzYyOzwv
Y29kZT4gdGFnLjwvcD4KCgk8cD5UaGlzIHRhZyBhbHNvIHNoYXJlcyBhbGwgb2YgdGhlIHNh
bWUgYXR0cmlidXRlcyBhcyA8Y29kZT4mIzYwO3R4cDpsaW5rX3RvX25leHQgLyYjNjI7PC9j
b2RlPi4gRm9yIGEgY29tcGxldGUgbGlzdCBvZiBhcHBsaWNhYmxlIGF0dHJpYnV0ZXMsIHNl
ZSA8YSBocmVmPSJodHRwOi8vdGV4dGJvb2sudGV4dHBhdHRlcm4ubmV0L3dpa2kvaW5kZXgu
cGhwP3RpdGxlPVR4cDpsaW5rX3RvX25leHQiPnRoaXMgVGV4dGJvb2sgZW50cnk8L2E+Ljwv
cD4KCgk8cD5Gb3IgYSBmdXJ0aGVyIGV4cGxhbmF0aW9uIG9mIHRoZSBiZW5lZml0cyBvZiB1
c2luZyA8Y29kZT4mIzYwO2xpbmsmIzYyOzwvY29kZT4gdGFncyBmb3IgeW91ciBzaXRlJiM4
MjE3O3MgbmF2aWdhdGlvbiwgcGxlYXNlIHNlZSA8YSBocmVmPSJodHRwOi8vZGl2ZWludG9h
Y2Nlc3NpYmlsaXR5Lm9yZy9kYXlfOV9wcm92aWRpbmdfYWRkaXRpb25hbF9uYXZpZ2F0aW9u
X2FpZHMuaHRtbCI+RGF5IDk6IFByb3ZpZGluZyBhZGRpdGlvbmFsIG5hdmlnYXRpb24gYWlk
czwvYT4gZnJvbSBNYXJrIFBpbGdyaW0mIzgyMTc7cyA8YSBocmVmPSJodHRwOi8vZGl2ZWlu
dG9hY2Nlc3NpYmlsaXR5Lm9yZy8iPgpEaXZlIEludG8gQWNjZXNzaWJpbGl0eTwvYT4uPC9w
PiI7czo0OiJjb2RlIjtzOjk4ODoiCi8vIFBsdWdpbiBjb2RlIGdvZXMgaGVyZS4gIE5vIG5l
ZWQgdG8gZXNjYXBlIHF1b3Rlcy4KCgpmdW5jdGlvbiBjd2hfbGlua190b19uZXh0KCRhdHRz
LCAkdGhpbmcpCnsKCWdsb2JhbCAkaWQsICRuZXh0X2lkLCAkbmV4dF90aXRsZTsKCglleHRy
YWN0KGxBdHRzKGFycmF5KAoJCSdmb3JtYXQnICAgICA9PiAnJywgLy8gbmV3IGZvcm1hdCBh
dHRyaWJ1dGUKCQknc2hvd2Fsd2F5cycgPT4gMCwKCSksICRhdHRzKSk7CgoJaWYgKGludHZh
bCgkaWQpID09IDApCgl7CgkJZ2xvYmFsICR0aGlzYXJ0aWNsZSwgJHM7CgoJCWV4dHJhY3Qo
Z2V0TmV4dFByZXYoCgkJCUAkdGhpc2FydGljbGVbJ3RoaXNpZCddLAoJCQlAc3RyZnRpbWUo
JyVZLSVtLSVkICVIOiVNOiVTJywgJHRoaXNhcnRpY2xlWydwb3N0ZWQnXSksCgkJCUAkcwoJ
CSkpOwoJfQoKCWlmICgkbmV4dF9pZCkKCXsKCQkkdXJsID0gcGVybWxpbmt1cmxfaWQoJG5l
eHRfaWQpOwoKCQkJaWYgKCRmb3JtYXQgPT0gJ2xpbmsnKQogICAgICAgICAgICB7CiAgICAg
ICAgCQlyZXR1cm4gJzxsaW5rIHJlbD0ibmV4dCIgaHJlZj0iJy4kdXJsLiciJy4KICAgICAg
ICAgICAgCQkoJG5leHRfdGl0bGUgIT0gJHRoaW5nID8gJyB0aXRsZT0iJy4kbmV4dF90aXRs
ZS4nIicgOiAnJykuJyAvPic7CiAgICAgICAgCX0KCgogICAgICAgICAgICBlbHNlaWYgKCR0
aGluZykKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgJHRoaW5nID0gcGFyc2UoJHRo
aW5nKTsKCiAgICAgICAgICAgICAgICByZXR1cm4gJzxhIHJlbD0ibmV4dCIgaHJlZj0iJy4k
dXJsLiciJy4KICAgIAkJCSAgICAoJG5leHRfdGl0bGUgIT0gJHRoaW5nID8gJyB0aXRsZT0i
Jy4kbmV4dF90aXRsZS4nIicgOiAnJykuCiAgICAJCQkJJz4nLiR0aGluZy4nPC9hPic7CiAg
ICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiAkdXJsOwoJfQogICAgIHJldHVybiAo
JHNob3dhbHdheXMpID8gcGFyc2UoJHRoaW5nKSA6ICcnOwp9CiI7czozOiJtZDUiO3M6MzI6
IjIzOTZkNGYxNWI5MjQ0MmYxMWQxNDNhN2FhMzY0MzczIjt9
